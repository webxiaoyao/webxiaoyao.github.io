<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
</head>
<body>
	<div>
		<div>
			<label for="">audio Source</label>
			<select name="" id="audioSource"></select>
		</div>
		<div>
			<label for="">audio output</label>
			<select name="" id="audioOutput"></select>
		</div>
		<div>
			<label for="">video Source</label>
			<select name="" id="videoSource"></select>
		</div>
		<video autoplay playsinline id="player"></video>
	</div>
	<script>
		function gotUserMedia(stream) {
			var video = document.querySelector('#player')
			video.srcObject = stream
			return navigator.mediaDevices.enumerateDevices()
		}
		function gotMediaDevices(devicesInfos) {
			var audioSource = document.querySelector('select#audioSource')
			var audioOutput = document.querySelector('select#audioOutput')
			var videoSource = document.querySelector('select#videoSource')
			devicesInfos.forEach(function (deviceInfo) {
				var option = document.createElement('option')
				option.text = deviceInfo.label
				option.value = deviceInfo.deviceId
				if (deviceInfo.kind === 'audioinput') {
					audioSource.appendChild(option)
				} else if (deviceInfo.kind === 'audiooutput') {
					audioOutput.appendChild(option)
				} else if (deviceInfo.kind === 'videoinput') {
					videoSource.appendChild(option)
				}
			})
		}

		function init() {
			if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
				console.log('当前浏览器不支持')
				return
			}
			var constraints = {
				video: {
					width: 320,
					height: 640,
					frameRate: 30, // 帧
					facingMode: 'environment' // 后置摄像头 user前置摄像头
				},
				audio: true
			}
			navigator.mediaDevices.getUserMedia(constraints)
							.then(gotUserMedia)
							.then(gotMediaDevices)
							.catch(err => {
								console.log('err' + err)
							})
		}
		init()
	</script>
</body>
</html>